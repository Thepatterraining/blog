---
title: 设计模式之装饰器模式--各种功能随意扩展
date: 2020-05-05 17:22:45
tags: ['设计原则','设计模式']
category: 设计模式
article: 设计模式之装饰器模式--各种功能随意扩展
---

# 设计模式之装饰器模式--各种功能随意扩展

`装饰器模式`是灵活给原有类装饰新功能。

> 动态的给对象添加额外职责，就增加功能来说，装饰模式比生成子类更为灵活。

## 为什么要使用装饰器模式

如果你需要添加一些额外的功能，再不修改原有类的基础上，给原有类套个壳。并且可以套多个壳，我觉得装饰器模式有点像中间件。

比如你现在有一个登录的功能。

你现在需要给登录加一个权限控制。然后还要增加一个登录日志。还要增加登录微信通知。如果修改原有类可能引起未知bug。

可以使用装饰器模式。

```php
/**
 * 装饰器模式
 * 装饰器父类
 */
class Decorate {
    function __construct($compent) {
        $this->compent = $compent;
    }

    function login() {
        $this->compent->login();
    }
}

/**
 * 装饰器模式
 * 权限装饰器
 */
class LoginAuth extends Decorate {
    function login() {
        dump('判断登录权限');
        parent::login();
    }
}

/**
 * 装饰器模式
 * 登录日志装饰器
 */
class LoginLog extends Decorate {
    function login() {
        parent::login();
        dump('记录登录日志');
    }
}


/**
 * 装饰器模式
 * 微信通知装饰器
 */
class LoginWechat extends Decorate {
    function login() {
        parent::login();
        dump('发送微信登录通知');
    }
}

```

下面是原来的登录功能

```php
/**
 * 装饰器模式
 * 核心代码
 * 登录功能
 */
class login {
    function login() {
        dump('用户登录');
    }
}

```

原来的客户端直接调用login，只有登录功能。

```php
$login = new login();
$login->login();
```

增加了装饰器以后可以把登录功能放入装饰器。

```php
$login = new login;

//使用权限装饰器
$login = new LoginAuth($login);

//使用登录日志装饰器
$login = new LoginLog($login);

//使用微信通知装饰器
$login = new LoginWechat($login);

$login->login();
```

![decorate](../images/decorator1.png)

还可以任意调换装饰器的位置，可以先发送微信通知在记录登录日志。

```php

$login = new login;

//使用微信通知装饰器
$login = new LoginWechat($login);

//使用登录日志装饰器
$login = new LoginLog($login);

//使用权限装饰器
$login = new LoginAuth($login);

$login->login();
```

![decorate](../images/decorator2.png)

这个模式就非常灵活，可以任意组装自己的装饰，比如购买支付的时候，需要装饰积分发放，账单通知这些。而且每个装饰器的职责单一，方便插拔，如果不需要一个装饰器的时候把这个装饰器去掉就可以了。

代码放在了我的github上面。

- [设计模式](https://github.com/Thepatterraining/design-pattern)
