---
title: 一文带你搞懂为什么大家都推荐count*而不是countid
date: 2020-04-24 16:11:01
tags: ['mysql']
category: mysql
article: 一文带你搞懂为什么大家都推荐count*而不是countid
---

# 一文带你搞懂为什么大家都推荐count(*)而不是count(id)

在开发中，我们经常用到count这个函数来计算行数，尤其是后台列表展示。

那么究竟应该使用count(*)还是count(id)呢？很多人，很多书籍都推荐使用count(*)。

### count(*)

在每个引擎里面其实是不一样的，比如myisam引擎，会把总行数存起来，如果你需要总行数，那么直接返回，那速度嗖嗖嗖的。

我们常用的innoDB引擎呢，他就真的是一行行计数了。

那为什么一行行计数还推荐count(*)呢？

innoDB是索引树组织表，不仅有主键索引树还有其他索引树，而count(*)反正是要全表扫描，那么优化器会去遍历最小的索引树，普通索引树的叶子节点只有id，当然要更小一些。

执行这个的时候innoDB遍历全表，但不取值，并且不判断，因为count(*)肯定不是null，直接累加。

### count(id)

执行这个的时候innoDB遍历全表，把每一行数据的id值取出来返回给mysql，mysql拿到数据以后判断不为空则+1。累加后返回。

### count(1)

执行这个的时候innoDB遍历全表，但不取值，直接返回给mysql，mysql收到返回值，给返回值赋值1，然后判断，累加。

### count(字段)

这个和count(id)类似，只不过如果允许为空的话，需要把值取出来做个判断，多个判断。如果不允许为空，那就一样了。

这么一对比，就看出来了，显然count(*)更快，这也是因为mysql对count(*)这个语句专门做了优化。所以更推荐count(*)

> count(字段) 慢于 count(id) 慢于 count(1) 慢于 count(*)

除了这些我们同样可以自己实现计数。

我们可以使用缓存系统，将计数放入缓存，然后持久化。比如redis。

我们也可以直接创建一个计数的表，把计数字段放入表里。

